"use strict";

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/*
	dhpay.js
	@version 1.8
	@date 2017-3-6
	@author baosheng
*/
!function (e) {
	var t,
	    a,
	    _n,
	    i,
	    o,
	    s,
	    r,
	    c = "https://pay.17m3.com/gamepay/",
	    l = "https://pay.17m3.com/sdk/CodeWappay.aspx",
	    d = "",
	    p = { alipay: ["alipay", c + "alipay_web.png", "支付宝支付"], weixin: ["weixin", c + "pay_weixin_qr.png", "微信支付"] },
	    u = [],
	    h = !1,
	    y = !1;!function () {
		"use strict";
		function e(t, n) {
			function i(e, t) {
				return function () {
					return e.apply(t, arguments);
				};
			}var o;if (n = n || {}, this.trackingClick = !1, this.trackingClickStart = 0, this.targetElement = null, this.touchStartX = 0, this.touchStartY = 0, this.lastTouchIdentifier = 0, this.touchBoundary = n.touchBoundary || 10, this.layer = t, this.tapDelay = n.tapDelay || 200, this.tapTimeout = n.tapTimeout || 700, !e.notNeeded(t)) {
				for (var s = ["onMouse", "onClick", "onTouchStart", "onTouchMove", "onTouchEnd", "onTouchCancel"], r = this, c = 0, l = s.length; c < l; c++) {
					r[s[c]] = i(r[s[c]], r);
				}a && (t.addEventListener("mouseover", this.onMouse, !0), t.addEventListener("mousedown", this.onMouse, !0), t.addEventListener("mouseup", this.onMouse, !0)), t.addEventListener("click", this.onClick, !0), t.addEventListener("touchstart", this.onTouchStart, !1), t.addEventListener("touchmove", this.onTouchMove, !1), t.addEventListener("touchend", this.onTouchEnd, !1), t.addEventListener("touchcancel", this.onTouchCancel, !1), Event.prototype.stopImmediatePropagation || (t.removeEventListener = function (e, a, n) {
					var i = Node.prototype.removeEventListener;"click" === e ? i.call(t, e, a.hijacked || a, n) : i.call(t, e, a, n);
				}, t.addEventListener = function (e, a, n) {
					var i = Node.prototype.addEventListener;"click" === e ? i.call(t, e, a.hijacked || (a.hijacked = function (e) {
						e.propagationStopped || a(e);
					}), n) : i.call(t, e, a, n);
				}), "function" == typeof t.onclick && (o = t.onclick, t.addEventListener("click", function (e) {
					o(e);
				}, !1), t.onclick = null);
			}
		}var t = navigator.userAgent.indexOf("Windows Phone") >= 0,
		    a = navigator.userAgent.indexOf("Android") > 0 && !t,
		    n = /iP(ad|hone|od)/.test(navigator.userAgent) && !t,
		    i = n && /OS 4_\d(_\d)?/.test(navigator.userAgent),
		    o = n && /OS [6-7]_\d/.test(navigator.userAgent),
		    s = navigator.userAgent.indexOf("BB10") > 0;e.prototype.needsClick = function (e) {
			switch (e.nodeName.toLowerCase()) {case "button":case "select":case "textarea":
					if (e.disabled) return !0;break;case "input":
					if (n && "file" === e.type || e.disabled) return !0;break;case "label":case "iframe":case "video":
					return !0;}return (/\bneedsclick\b/.test(e.className)
			);
		}, e.prototype.needsFocus = function (e) {
			switch (e.nodeName.toLowerCase()) {case "textarea":
					return !0;case "select":
					return !a;case "input":
					switch (e.type) {case "button":case "checkbox":case "file":case "image":case "radio":case "submit":
							return !1;}return !e.disabled && !e.readOnly;default:
					return (/\bneedsfocus\b/.test(e.className)
					);}
		}, e.prototype.sendClick = function (e, t) {
			var a, n;document.activeElement && document.activeElement !== e && document.activeElement.blur(), n = t.changedTouches[0], a = document.createEvent("MouseEvents"), a.initMouseEvent(this.determineEventType(e), !0, !0, window, 1, n.screenX, n.screenY, n.clientX, n.clientY, !1, !1, !1, !1, 0, null), a.forwardedTouchEvent = !0, e.dispatchEvent(a);
		}, e.prototype.determineEventType = function (e) {
			return a && "select" === e.tagName.toLowerCase() ? "mousedown" : "click";
		}, e.prototype.focus = function (e) {
			var t;n && e.setSelectionRange && 0 !== e.type.indexOf("date") && "time" !== e.type && "month" !== e.type ? (t = e.value.length, e.setSelectionRange(t, t)) : e.focus();
		}, e.prototype.updateScrollParent = function (e) {
			var t, a;if (t = e.fastClickScrollParent, !t || !t.contains(e)) {
				a = e;do {
					if (a.scrollHeight > a.offsetHeight) {
						t = a, e.fastClickScrollParent = a;break;
					}a = a.parentElement;
				} while (a);
			}t && (t.fastClickLastScrollTop = t.scrollTop);
		}, e.prototype.getTargetElementFromEventTarget = function (e) {
			return e.nodeType === Node.TEXT_NODE ? e.parentNode : e;
		}, e.prototype.onTouchStart = function (e) {
			var t, a, o;if (e.targetTouches.length > 1) return !0;if (t = this.getTargetElementFromEventTarget(e.target), a = e.targetTouches[0], n) {
				if (o = window.getSelection(), o.rangeCount && !o.isCollapsed) return !0;if (!i) {
					if (a.identifier && a.identifier === this.lastTouchIdentifier) return e.preventDefault(), !1;this.lastTouchIdentifier = a.identifier, this.updateScrollParent(t);
				}
			}return this.trackingClick = !0, this.trackingClickStart = e.timeStamp, this.targetElement = t, this.touchStartX = a.pageX, this.touchStartY = a.pageY, e.timeStamp - this.lastClickTime < this.tapDelay && e.preventDefault(), !0;
		}, e.prototype.touchHasMoved = function (e) {
			var t = e.changedTouches[0],
			    a = this.touchBoundary;return Math.abs(t.pageX - this.touchStartX) > a || Math.abs(t.pageY - this.touchStartY) > a;
		}, e.prototype.onTouchMove = function (e) {
			return !this.trackingClick || ((this.targetElement !== this.getTargetElementFromEventTarget(e.target) || this.touchHasMoved(e)) && (this.trackingClick = !1, this.targetElement = null), !0);
		}, e.prototype.findControl = function (e) {
			return void 0 !== e.control ? e.control : e.htmlFor ? document.getElementById(e.htmlFor) : e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea");
		}, e.prototype.onTouchEnd = function (e) {
			var t,
			    s,
			    r,
			    c,
			    l,
			    d = this.targetElement;if (!this.trackingClick) return !0;if (e.timeStamp - this.lastClickTime < this.tapDelay) return this.cancelNextClick = !0, !0;if (e.timeStamp - this.trackingClickStart > this.tapTimeout) return !0;if (this.cancelNextClick = !1, this.lastClickTime = e.timeStamp, s = this.trackingClickStart, this.trackingClick = !1, this.trackingClickStart = 0, o && (l = e.changedTouches[0], d = document.elementFromPoint(l.pageX - window.pageXOffset, l.pageY - window.pageYOffset) || d, d.fastClickScrollParent = this.targetElement.fastClickScrollParent), r = d.tagName.toLowerCase(), "label" === r) {
				if (t = this.findControl(d)) {
					if (this.focus(d), a) return !1;d = t;
				}
			} else if (this.needsFocus(d)) return e.timeStamp - s > 100 || n && window.top !== window && "input" === r ? (this.targetElement = null, !1) : (this.focus(d), this.sendClick(d, e), n && "select" === r || (this.targetElement = null, e.preventDefault()), !1);return !(!n || i || (c = d.fastClickScrollParent, !c || c.fastClickLastScrollTop === c.scrollTop)) || (this.needsClick(d) || (e.preventDefault(), this.sendClick(d, e)), !1);
		}, e.prototype.onTouchCancel = function () {
			this.trackingClick = !1, this.targetElement = null;
		}, e.prototype.onMouse = function (e) {
			return !this.targetElement || !!e.forwardedTouchEvent || !e.cancelable || !(!this.needsClick(this.targetElement) || this.cancelNextClick) || (e.stopImmediatePropagation ? e.stopImmediatePropagation() : e.propagationStopped = !0, e.stopPropagation(), e.preventDefault(), !1);
		}, e.prototype.onClick = function (e) {
			var t;return this.trackingClick ? (this.targetElement = null, this.trackingClick = !1, !0) : "submit" === e.target.type && 0 === e.detail || (t = this.onMouse(e), t || (this.targetElement = null), t);
		}, e.prototype.destroy = function () {
			var e = this.layer;a && (e.removeEventListener("mouseover", this.onMouse, !0), e.removeEventListener("mousedown", this.onMouse, !0), e.removeEventListener("mouseup", this.onMouse, !0)), e.removeEventListener("click", this.onClick, !0), e.removeEventListener("touchstart", this.onTouchStart, !1), e.removeEventListener("touchmove", this.onTouchMove, !1), e.removeEventListener("touchend", this.onTouchEnd, !1), e.removeEventListener("touchcancel", this.onTouchCancel, !1);
		}, e.notNeeded = function (e) {
			var t, n, i, o;if ("undefined" == typeof window.ontouchstart) return !0;if (n = +(/Chrome\/([0-9]+)/.exec(navigator.userAgent) || [, 0])[1]) {
				if (!a) return !0;if (t = document.querySelector("meta[name=viewport]")) {
					if (t.content.indexOf("user-scalable=no") !== -1) return !0;if (n > 31 && document.documentElement.scrollWidth <= window.outerWidth) return !0;
				}
			}if (s && (i = navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/), i[1] >= 10 && i[2] >= 3 && (t = document.querySelector("meta[name=viewport]")))) {
				if (t.content.indexOf("user-scalable=no") !== -1) return !0;if (document.documentElement.scrollWidth <= window.outerWidth) return !0;
			}return "none" === e.style.msTouchAction || "manipulation" === e.style.touchAction || (o = +(/Firefox\/([0-9]+)/.exec(navigator.userAgent) || [, 0])[1], !!(o >= 27 && (t = document.querySelector("meta[name=viewport]"), t && (t.content.indexOf("user-scalable=no") !== -1 || document.documentElement.scrollWidth <= window.outerWidth))) || "none" === e.style.touchAction || "manipulation" === e.style.touchAction);
		}, e.attach = function (t, a) {
			return new e(t, a);
		}, "function" == typeof define && "object" == _typeof(define.amd) && define.amd ? define(function () {
			return e;
		}) : "undefined" != typeof module && module.exports ? (module.exports = e.attach, module.exports.FastClick = e) : window.FastClick = e;
	}(), a = function a(e, t, _a) {
		var n = document.createElement(t);"script" == t ? (n.src = e, n.type = "text/javascript", n.onload = n.onreadystatechange = function () {
			n.readyState && !/loaded|complete/.test(n.readyState) || (n.onload = n.onreadystatechange = null, _a && _a());
		}) : (n.href = e, n.rel = "stylesheet", n.type = "text/css"), document.getElementsByTagName("head")[0].appendChild(n);
	}, toDecimal2 = function toDecimal2(e) {
		var t = parseFloat(e);if (isNaN(t)) return !1;var t = Math.round(100 * e) / 100,
		    a = t.toString(),
		    n = a.indexOf(".");for (n < 0 && (n = a.length, a += "."); a.length <= n + 2;) {
			a += "0";
		}return a;
	}, _n = function n(e, t) {
		var a = "";return e instanceof String || e instanceof Number || e instanceof Boolean ? a += "&" + t + "=" + encodeURIComponent(e) : $.each(e, function (i) {
			var o = null == t ? i : t + (e instanceof Array ? "[" + i + "]" : "." + i);a += "&" + _n(this, o);
		}), a.substr(1);
	}, t = { versions: function () {
			var e = navigator.userAgent;navigator.appVersion;return { trident: e.indexOf("Trident") > -1, presto: e.indexOf("Presto") > -1, webKit: e.indexOf("AppleWebKit") > -1, gecko: e.indexOf("Gecko") > -1 && e.indexOf("KHTML") == -1, mobile: !!e.match(/AppleWebKit.*Mobile.*/), ios: !!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), android: e.indexOf("Android") > -1 || e.indexOf("Adr") > -1, iPhone: e.indexOf("iPhone") > -1, iPad: e.indexOf("iPad") > -1, webApp: e.indexOf("Safari") == -1, weixin: e.indexOf("MicroMessenger") > -1, qq: "qq" == e.match(/\sQQ/i) };
		}(), language: (navigator.browserLanguage || navigator.language).toLowerCase() }, a(c + "dhpay.css", "link"), "undefined" == typeof jQuery && a("https://static.m3guo.com/passport/v1/js/jquery-1.8.3.min.js", "script"), o = { closecallback: {}, payfor: function payfor(e) {
			e.closecallback && (h = !1, this.closecallback = e.closecallback), y = !!e.resultpost && e.resultpost, i = e.postjson, d = "";var a = '<li class="' + p.alipay[0] + '"><a href="javascript:void(0);" data-type="' + p.alipay[0] + '"><img src="' + p.alipay[1] + '"><span>' + p.alipay[2] + "</span></a></li>",
			    n = '<li class="' + p.weixin[0] + '"><a href="javascript:void(0);" data-type="' + p.weixin[0] + '"><img src="' + p.weixin[1] + '"><span>' + p.weixin[2] + "</span></a></li>";e.config ? ((e.config.alipay || "undefined" == typeof e.config.alipay) && (d += a, u.push("alipay")), (e.config.weixin || "undefined" == typeof e.config.weixin) && (d += n, u.push("weixin"))) : d = a + n, (t.versions.ios || t.versions.android) && t.versions.weixin && (r.userData = i, r.userData.payChannel = "weixin", r.getpayBydata()), FastClick.attach(document.body), r.int();
		}, hidepay: function hidepay(e) {
			if (y || 1 == e) {
				var t = this;return u.length = 0, $("#payModelMask").length > 0 && $("#payModelMask").remove(), "function" != typeof t.closecallback || h || (h = !0, t.closecallback()), !0;
			}return !0;
		} }, s = { int: function int() {
			this.startHTML(), this.startview();
		}, startview: function startview() {
			var e = this;new function () {
				var e = this;e.width = 640, e.fontSize = 40, e.widthProportion = function () {
					var t = (document.body && document.body.clientWidth || document.getElementsByTagName("html")[0].offsetWidth) / e.width;return t > 1 ? 1 : t < .5 ? .5 : t;
				}, e.changePage = function () {
					document.getElementsByTagName("html")[0].setAttribute("style", "font-size:" + e.widthProportion() * e.fontSize + "px !important");
				}, e.changePage(), window.addEventListener("resize", function () {
					e.changePage();
				}, !1);
			}();var a = (t.versions.ios || t.versions.android) && t.versions.weixin;a || e.showSection({ eleary: ["all"] });
		}, startHTML: function startHTML() {
			var e = '<div class="pay-model-mask" id="payModelMask"><div id="PayModelBox" class="pay-model-box"><section id="PaywayBox" class="paywayBox"><div class="pay-model-hd"><div class="payborder"></div><p>￥' + toDecimal2(i.amount / 100) + "</p><span>" + i.subject + '</span><a class="closepaybtn" href="javascript:void(0);">&#10005;</a></div><div class="pay-model-bd"><ul class="payway-list" id="DHpaylist">' + d + '</ul></div></section><section id="PayboxCode" class="payboxCode"><div class="pay-model-bd"><div class="pay-model-wayer">支付<a href="javascript:void(0);" class="closepaybtn">&#10005;</a></div><div id="payWayerTit" class="pay-wayer-tit">请长按二维码识别支付</div><div class="codecon" id="CodeContent"><img src=""></div></div></section><section id="PayTip" class="paytip"><div class="pay-model-tip"><span>请点击确认支付</span><a id="tipcloseBtn" class="close">&#10005;</a></div><a id="paysureBtn" href="javascript:void(0);">确认支付</a></section></div></div>';$("#payModelMask").length > 0 && $("#payModelMask").remove(), $("body").append(e), 1 == $("#DHpaylist li").length && $("#DHpaylist li").addClass("center");
		}, showSection: function showSection(e) {
			$("#DHpaylist");if ("undefined" == typeof e.section && (e.section = "#PaywayBox"), "#PayLoading" == e.section) {
				$("#payModelMask").css("display", "none");var t = '<div id="PayLoading"><div class="spinner"><div class="spinner-container container1"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div><div class="spinner-container container2"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div><div class="spinner-container container3"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div></div></div>';return void $("body").append(t);
			}if ("#PayTip" == e.section && $("#PayModelBox").addClass("small"), $("#payModelMask").css("display", "block"), $(e.section).css("display", "block"), $(e.section).siblings("section").css("display", "none"), "undefined" != typeof e.eleary && 0 != e.eleary.length) if (1 == e.eleary.length) "all" == e.eleary[0] ? $("#DHpaylist li").css("display", "block") : $("#DHpaylist " + e.eleary[0]).css({ display: "block", "margin-left": "3.02rem", border: "none" });else if (e.eleary.length > 1) for (var a = 0; a < e.eleary.length; a++) {
				$("#DHpaylist " + e.eleary[a]).css({ display: "block" });
			}
		}, removeLoading: function removeLoading() {
			$("#PayLoading").remove();
		} }, r = { userData: {}, int: function int() {
			s.int(), this.userData = i, this.bind();
		}, bind: function bind() {
			var e = this;$("#DHpaylist").on("click", "a", function () {
				var t = $(this).attr("data-type");e.userData.payChannel = t, e.getpayBydata();
			}), $("#tipcloseBtn").click(function () {
				o.hidepay(1);
			}), $("#paysureBtn").click(function () {
				$("#alipaysubmit").submit(), o.hidepay(1);
			}), $("#payModelMask").click(function () {
				o.hidepay(1);
			}), $("#PayModelBox").click(function (e) {
				e.stopPropagation();
			}), $(".closepaybtn").click(function () {
				o.hidepay(1);
			}), window.addEventListener("message", function (e) {
				var t = {};t = "object" == _typeof(e.data) ? e.data : JSON.parse(e.data), t.closeCode && o.hidepay(1);
			}, !1);
		}, onBridgeReady: function onBridgeReady(e) {
			parent === window ? WeixinJSBridge.invoke("getBrandWCPayRequest", { appId: e.wxappId, timeStamp: e.wxtimeStamp, nonceStr: e.wxnonceStr, package: e.wxpackage, signType: e.wxsignType, paySign: e.wxpaySign }, function (e) {
				"get_brand_wcpay_request:ok" == e.err_msg && alert("OK");
			}) : parent.postMessage(JSON.stringify(e), "*");
		}, template: function template(e, t, a) {
			$("#alipaysubmit").length > 0 && $("#alipaysubmit").each(function () {
				$(this).remove();
			});for (var n = "", i = "", o = "", s = "", r = "_self", c = 0; c < e.length; c++) {
				"actionurl" == e[c].name ? o = e[c].value : "_input_charset" == e[c].name ? s = e[c].value : i += '<input type="hidden" name="' + e[c].name + '" value="' + e[c].value + '">';
			}return a && (r = "_bank"), n = '<form id="alipaysubmit" name="alipaysubmit" action="' + o + "_input_charset=" + s + '" target="' + r + '" method="POST">' + i + '<input type="submit" value="确认" style="display:none;"></form>', t && (n += '<script>document.forms["alipaysubmit"].submit();</script>'), n;
		}, payforBydata: function payforBydata() {
			var e = this,
			    a = _n(e.userData);$.ajax({ type: "GET", cache: !1, url: l + "?" + a, dataType: "jsonp", jsonpCallback: "callback" + new Date().getTime(), beforeSend: function beforeSend() {
					s.showSection({ section: "#PayLoading" });
				}, success: function success(a) {
					if (s.removeLoading(), 1 == a.result) switch (e.userData.payScene) {case 1:
							"alipay" == e.userData.payChannel ? ($("body").append(e.template(a.data, !1, !0)), s.showSection({ section: "#PayTip" })) : "weixin" == e.userData.payChannel && ((t.versions.ios || t.versions.android) && t.versions.weixin && parent != window ? parent.postMessage(JSON.stringify({ operate: "requestShowQrcode", codeUrl: a.data }), "*") : ($("#CodeContent img").attr("src", a.data), t.versions.weixin ? $("#payWayerTit").html("长按二维码识别") : $("#payWayerTit").html("请使用微信扫码支付"), s.showSection({ section: "#PayboxCode" })));break;case 2:
							var n = {};"alipay" == e.userData.payChannel ? parent !== window ? (n.operate = "requestOpenAPP_alipayPay", n.app = "支付宝", n.resultInfo = e.template(a.data, !0, !1), parent.postMessage(JSON.stringify(n), "*")) : $("body").append(e.template(a.data, !0, !1)) : "weixin" == e.userData.payChannel && (parent !== window ? (n.operate = "requestOpenAPP_wxPay", n.app = "微信", n.resultInfo = a.data, parent.postMessage(JSON.stringify(n), "*")) : window.location.href = a.data);break;case 3:
							if ("weixin" == e.userData.payChannel) parent !== window ? parent.postMessage(JSON.stringify({ operate: "requestShowQrcode", codeUrl: a.data }), "*") : ($("#CodeContent img").attr("src", a.data), $("#payWayerTit").html("长按二维码识别"), s.showSection({ section: "#PayboxCode" }));else if ("wxjsapi" == e.userData.payChannel) {
								var i = { wxappId: a.data.appId, wxtimeStamp: a.data.timeStamp, wxnonceStr: a.data.nonceStr, wxpackage: a.data.package, wxsignType: a.data.signType, wxpaySign: a.data.paySign };parent !== window ? e.onBridgeReady(i) : "undefined" == typeof WeixinJSBridge ? document.addEventListener ? document.addEventListener("WeixinJSBridgeReady", function () {
									e.onBridgeReady(i);
								}, !1) : document.attachEvent && (document.attachEvent("WeixinJSBridgeReady", function () {
									e.onBridgeReady(i);
								}), document.attachEvent("onWeixinJSBridgeReady", function () {
									e.onBridgeReady(i);
								})) : e.onBridgeReady(i);
							}} else o.closecallback && !h && (h = !0, o.closecallback()), alert(a.data);
				} });
		}, getpayBydata: function getpayBydata() {
			var e = this;!t.versions.ios && !t.versions.android || t.versions.weixin ? (t.versions.ios || t.versions.android) && t.versions.weixin && "weixin" == e.userData.payChannel && "undefined" != typeof e.userData.wxopenid && "" != e.userData.wxopenid ? (e.userData.payScene = 3, e.userData.payChannel = "wxjsapi") : e.userData.payScene = 1 : e.userData.payScene = 2, e.payforBydata();
		} }, e.dhpayObj = o;
}(window);